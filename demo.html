<html dir="ltr" mozdisallowselectionprint="" moznomarginboxes=""><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google" content="notranslate">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>compressed.tracemonkey-pldi-09.pdf</title>


    <link rel="stylesheet" href="viewer.css">

    <script src="compatibility.js"></script>



<!-- This snippet is used in production (included from viewer.html) -->
<link rel="resource" type="application/l10n" href="locale/locale.properties">
<script src="l10n.js"></script>
<script src="../build/pdf.js"></script>



    <script src="debugger.js"></script>
    <script src="viewer.js"></script>

  </head>

  <body tabindex="1" class="">
    <div id="outerContainer">

      <div id="sidebarContainer">
        <div id="toolbarSidebar">
          <div class="splitToolbarButton toggled">
            <button id="viewThumbnail" class="toolbarButton group toggled" title="显示缩略图" tabindex="2" data-l10n-id="thumbs">
               <span data-l10n-id="thumbs_label">缩略图</span>
            </button>
            <button id="viewOutline" class="toolbarButton group" title="显示文档大纲" tabindex="3" data-l10n-id="outline" disabled="">
               <span data-l10n-id="outline_label">文档大纲</span>
            </button>
            <button id="viewAttachments" class="toolbarButton group" title="显示附件" tabindex="4" data-l10n-id="attachments" disabled="">
               <span data-l10n-id="attachments_label">附件</span>
            </button>
          </div>
        </div>
        <div id="sidebarContent">
          <div id="thumbnailView">
          <a href="#page=1" title="页码 1"><div id="thumbnailContainer1" class="thumbnail selected"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=2" title="页码 2"><div id="thumbnailContainer2" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=3" title="页码 3"><div id="thumbnailContainer3" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=4" title="页码 4"><div id="thumbnailContainer4" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=5" title="页码 5"><div id="thumbnailContainer5" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=6" title="页码 6"><div id="thumbnailContainer6" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=7" title="页码 7"><div id="thumbnailContainer7" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=8" title="页码 8"><div id="thumbnailContainer8" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=9" title="页码 9"><div id="thumbnailContainer9" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=10" title="页码 10"><div id="thumbnailContainer10" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=11" title="页码 11"><div id="thumbnailContainer11" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=12" title="页码 12"><div id="thumbnailContainer12" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=13" title="页码 13"><div id="thumbnailContainer13" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a><a href="#page=14" title="页码 14"><div id="thumbnailContainer14" class="thumbnail"><div class="thumbnailSelectionRing" style="width: 100px; height: 128px;"></div></div></a></div>
          <div id="outlineView" class="hidden"></div>
          <div id="attachmentsView" class="hidden"></div>
        </div>
      </div>  <!-- sidebarContainer -->

      <div id="mainContainer">
        <div class="findbar hidden doorHanger hiddenSmallView" id="findbar">
          <label for="findInput" class="toolbarLabel" data-l10n-id="find_label">查找：</label>
          <input id="findInput" class="toolbarField" tabindex="91">
          <div class="splitToolbarButton">
            <button class="toolbarButton findPrevious" title="查找词语上一次出现的位置" id="findPrevious" tabindex="92" data-l10n-id="find_previous">
              <span data-l10n-id="find_previous_label">上一页</span>
            </button>
            <div class="splitToolbarButtonSeparator"></div>
            <button class="toolbarButton findNext" title="查找词语后一次出现的位置" id="findNext" tabindex="93" data-l10n-id="find_next">
              <span data-l10n-id="find_next_label">下一页</span>
            </button>
          </div>
          <input type="checkbox" id="findHighlightAll" class="toolbarField" tabindex="94">
          <label for="findHighlightAll" class="toolbarLabel" data-l10n-id="find_highlight">全部高亮显示</label>
          <input type="checkbox" id="findMatchCase" class="toolbarField" tabindex="95">
          <label for="findMatchCase" class="toolbarLabel" data-l10n-id="find_match_case_label">区分大小写</label>
          <span id="findResultsCount" class="toolbarLabel hidden"></span>
          <span id="findMsg" class="toolbarLabel"></span>
        </div>  <!-- findbar -->

        <div id="secondaryToolbar" class="secondaryToolbar hidden doorHangerRight">
          <div id="secondaryToolbarButtonContainer" style="max-height: 907px;">
            <button id="secondaryPresentationMode" class="secondaryToolbarButton presentationMode visibleLargeView" title="切换到演示模式" tabindex="51" data-l10n-id="presentation_mode">
              <span data-l10n-id="presentation_mode_label">演示模式</span>
            </button>

            <button id="secondaryOpenFile" class="secondaryToolbarButton openFile visibleLargeView" title="打开文件" tabindex="52" data-l10n-id="open_file">
              <span data-l10n-id="open_file_label">打开</span>
            </button>

            <button id="secondaryPrint" class="secondaryToolbarButton print visibleMediumView" title="打印" tabindex="53" data-l10n-id="print">
              <span data-l10n-id="print_label">打印</span>
            </button>

            <button id="secondaryDownload" class="secondaryToolbarButton download visibleMediumView" title="下载" tabindex="54" data-l10n-id="download">
              <span data-l10n-id="download_label">下载</span>
            </button>

            <a href="#page=3&amp;zoom=120,-67,727" id="secondaryViewBookmark" class="secondaryToolbarButton bookmark visibleSmallView" title="当前视图（复制或在新窗口中打开）" tabindex="55" data-l10n-id="bookmark">
              <span data-l10n-id="bookmark_label">当前视图</span>
            </a>

            <div class="horizontalToolbarSeparator visibleLargeView"></div>

            <button id="firstPage" class="secondaryToolbarButton firstPage" title="转到第一页" tabindex="56" data-l10n-id="first_page">
              <span data-l10n-id="first_page_label">转到第一页</span>
            </button>
            <button id="lastPage" class="secondaryToolbarButton lastPage" title="转到最后一页" tabindex="57" data-l10n-id="last_page">
              <span data-l10n-id="last_page_label">转到最后一页</span>
            </button>

            <div class="horizontalToolbarSeparator"></div>

            <button id="pageRotateCw" class="secondaryToolbarButton rotateCw" title="顺时针旋转" tabindex="58" data-l10n-id="page_rotate_cw">
              <span data-l10n-id="page_rotate_cw_label">顺时针旋转</span>
            </button>
            <button id="pageRotateCcw" class="secondaryToolbarButton rotateCcw" title="逆时针旋转" tabindex="59" data-l10n-id="page_rotate_ccw">
              <span data-l10n-id="page_rotate_ccw_label">逆时针旋转</span>
            </button>

            <div class="horizontalToolbarSeparator"></div>

            <button id="toggleHandTool" class="secondaryToolbarButton handTool" title="启用手形工具" tabindex="60" data-l10n-id="hand_tool_enable">
              <span data-l10n-id="hand_tool_enable_label">启用手形工具</span>
            </button>

            <div class="horizontalToolbarSeparator"></div>

            <button id="documentProperties" class="secondaryToolbarButton documentProperties" title="文档属性…" tabindex="61" data-l10n-id="document_properties">
              <span data-l10n-id="document_properties_label">文档属性…</span>
            </button>
          </div>
        </div>  <!-- secondaryToolbar -->

        <div class="toolbar">
          <div id="toolbarContainer">
            <div id="toolbarViewer">
              <div id="toolbarViewerLeft">
                <button id="sidebarToggle" class="toolbarButton" title="切换侧栏" tabindex="11" data-l10n-id="toggle_sidebar">
                  <span data-l10n-id="toggle_sidebar_label">切换侧栏</span>
                </button>
                <div class="toolbarButtonSpacer"></div>
                <button id="viewFind" class="toolbarButton group hiddenSmallView" title="在文档中查找" tabindex="12" data-l10n-id="findbar">
                   <span data-l10n-id="findbar_label">查找</span>
                </button>
                <div class="splitToolbarButton">
                  <button class="toolbarButton pageUp" title="上一页" id="previous" tabindex="13" data-l10n-id="previous">
                    <span data-l10n-id="previous_label">上一页</span>
                  </button>
                  <div class="splitToolbarButtonSeparator"></div>
                  <button class="toolbarButton pageDown" title="下一页" id="next" tabindex="14" data-l10n-id="next">
                    <span data-l10n-id="next_label">下一页</span>
                  </button>
                </div>
                <label id="pageNumberLabel" class="toolbarLabel" for="pageNumber" data-l10n-id="page_label">页面：</label>
                <input type="number" id="pageNumber" class="toolbarField pageNumber" value="1" size="4" min="1" tabindex="15" max="14">
                <span id="numPages" class="toolbarLabel">/ 14</span>
              </div>
              <div id="toolbarViewerRight">
                <button id="presentationMode" class="toolbarButton presentationMode hiddenLargeView" title="切换到演示模式" tabindex="31" data-l10n-id="presentation_mode">
                  <span data-l10n-id="presentation_mode_label">演示模式</span>
                </button>

                <button id="openFile" class="toolbarButton openFile hiddenLargeView" title="打开文件" tabindex="32" data-l10n-id="open_file">
                  <span data-l10n-id="open_file_label">打开</span>
                </button>

                <button id="print" class="toolbarButton print hiddenMediumView" title="打印" tabindex="33" data-l10n-id="print">
                  <span data-l10n-id="print_label">打印</span>
                </button>

                <button id="download" class="toolbarButton download hiddenMediumView" title="下载" tabindex="34" data-l10n-id="download">
                  <span data-l10n-id="download_label">下载</span>
                </button>
                <a href="#page=3&amp;zoom=120,-67,727" id="viewBookmark" class="toolbarButton bookmark hiddenSmallView" title="当前视图（复制或在新窗口中打开）" tabindex="35" data-l10n-id="bookmark">
                  <span data-l10n-id="bookmark_label">当前视图</span>
                </a>

                <div class="verticalToolbarSeparator hiddenSmallView"></div>

                <button id="secondaryToolbarToggle" class="toolbarButton" title="工具" tabindex="36" data-l10n-id="tools">
                  <span data-l10n-id="tools_label">工具</span>
                </button>
              </div>
              <div class="outerCenter">
                <div class="innerCenter" id="toolbarViewerMiddle">
                  <div class="splitToolbarButton">
                    <button id="zoomOut" class="toolbarButton zoomOut" title="缩小" tabindex="21" data-l10n-id="zoom_out">
                      <span data-l10n-id="zoom_out_label">缩小</span>
                    </button>
                    <div class="splitToolbarButtonSeparator"></div>
                    <button id="zoomIn" class="toolbarButton zoomIn" title="放大" tabindex="22" data-l10n-id="zoom_in">
                      <span data-l10n-id="zoom_in_label">放大</span>
                     </button>
                  </div>
                  <span id="scaleSelectContainer" class="dropdownToolbarButton" style="min-width: 85px; max-width: 85px;">
                     <select id="scaleSelect" title="缩放" tabindex="23" data-l10n-id="zoom" style="min-width: 107px;">
                      <option id="pageAutoOption" title="" value="auto" selected="selected" data-l10n-id="page_scale_auto">自动缩放</option>
                      <option id="pageActualOption" title="" value="page-actual" data-l10n-id="page_scale_actual">实际大小</option>
                      <option id="pageFitOption" title="" value="page-fit" data-l10n-id="page_scale_fit">适合页面</option>
                      <option id="pageWidthOption" title="" value="page-width" data-l10n-id="page_scale_width">适合页宽</option>
                      <option id="customScaleOption" title="" value="custom">120%</option>
                      <option title="" value="0.5" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 50 }">50%</option>
                      <option title="" value="0.75" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 75 }">75%</option>
                      <option title="" value="1" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 100 }">100%</option>
                      <option title="" value="1.25" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 125 }">125%</option>
                      <option title="" value="1.5" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 150 }">150%</option>
                      <option title="" value="2" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 200 }">200%</option>
                      <option title="" value="3" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 300 }">300%</option>
                      <option title="" value="4" data-l10n-id="page_scale_percent" data-l10n-args="{ &quot;scale&quot;: 400 }">400%</option>
                    </select>
                  </span>
                </div>
              </div>
            </div>
            <div id="loadingBar" class="hidden" style="width: calc(100% - 17px);">
              <div class="progress" style="height: 100%; width: 100%;">
                <div class="glimmer">
                </div>
              </div>
            </div>
          </div>
        </div>

        <menu type="context" id="viewerContextMenu">
          <menuitem id="contextFirstPage" label="First Page" data-l10n-id="first_page" title="转到第一页"></menuitem>
          <menuitem id="contextLastPage" label="Last Page" data-l10n-id="last_page" title="转到最后一页"></menuitem>
          <menuitem id="contextPageRotateCw" label="Rotate Clockwise" data-l10n-id="page_rotate_cw" title="顺时针旋转"></menuitem>
          <menuitem id="contextPageRotateCcw" label="Rotate Counter-Clockwise" data-l10n-id="page_rotate_ccw" title="逆时针旋转"></menuitem>
        </menu>

        <div id="viewerContainer" tabindex="0">
          <div id="viewer" class="pdfViewer"><div id="pageContainer1" class="page" data-page-number="1" data-loaded="true" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div><div class="canvasWrapper" style="width: 979px; height: 1267px;"><canvas id="page1" width="980" height="1268" style="width: 980px; height: 1268px;"></canvas></div><div class="textLayer" style="width: 979px; height: 1267px;"></div></div><div id="pageContainer2" class="page" data-page-number="2" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer3" class="page" data-page-number="3" data-loaded="true" style="width: 979px; height: 1267px;"><div class="canvasWrapper" style="width: 979px; height: 1267px;"><canvas id="page3" width="980" height="1268" style="width: 980px; height: 1268px;"></canvas></div><div class="textLayer" style="width: 979px; height: 1267px;"><div data-canvas-width="534.756096" style="left: 86.4px; top: 116.39716736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045827404865);">v0 := ld state[748]     // load primes from the trace activation record</div><div data-canvas-width="406.71590399999997" style="left: 131.59008px; top: 132.33732736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045791720379);">st sp[0], v0      // store primes to interpreter stack</div><div data-canvas-width="497.097216" style="left: 86.4px; top: 148.27748736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045818817687);">v1 := ld state[764]     // load k from the trace activation record</div><div data-canvas-width="414.2476799999999" style="left: 86.4px; top: 164.21780736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045794430109);">v2 := i2f(v1)           // convert k from int to double</div><div data-canvas-width="369.0570239999999" style="left: 131.59008px; top: 180.15796736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045776512712);">st sp[8], v1      // store k to interpreter stack</div><div data-canvas-width="399.184128" style="left: 131.59008px; top: 196.09828736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045788908395);">st sp[16], 0      // store false to interpreter stack</div><div data-canvas-width="399.18412799999993" style="left: 86.4px; top: 212.03844736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045788908395);">v3 := ld v0[4]          // load class word for primes</div><div data-canvas-width="474.50188799999995" style="left: 86.4px; top: 227.97860736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.0504581301112);">v4 := and v3, -4        // mask out object class tag for primes</div><div data-canvas-width="436.8430079999999" style="left: 86.4px; top: 243.91892736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045801998666);">v5 := eq v4, Array      // test whether primes is an array</div><div data-canvas-width="338.92991999999987" style="left: 131.59008px; top: 259.85908736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045761913356);">xf v5             // side exit if v5 is false</div><div data-canvas-width="542.2878719999999" style="left: 86.4px; top: 275.79940736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045828979181);">v6 := js_Array_set(v0, v2, false)  // call function to set array element</div><div data-canvas-width="406.7159039999999" style="left: 86.4px; top: 291.73956736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045791720379);">v7 := eq v6, 0          // test return value from call</div><div data-canvas-width="459.43833599999994" style="left: 131.59008px; top: 307.67972736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045808822777);">xt v7             // side exit if js_Array_set returns false.</div><div data-canvas-width="272.06209536000006" style="left: 86.4px; top: 344.0553344px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.925476189566037);">Figure 3. LIR snippet for sample program.</div><div data-canvas-width="526.3205068799999" style="left: 363.47296px; top: 344.22748928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.853558581466685);">This is the LIR recorded for line 5 of the sample program in Figure 1. The LIR encodes</div><div data-canvas-width="803.3894399999999" style="left: 86.4px; top: 360.16764928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.817875480384073);">the semantics in SSA form using temporary variables. The LIR also encodes all the stores that the interpreter would do to its data stack.</div><div data-canvas-width="803.38944" style="left: 86.4px; top: 376.10796928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.789077063513811);">Sometimes these stores can be optimized away as the stack locations are live only on exits to the interpreter. Finally, the LIR records guards</div><div data-canvas-width="387.29109504" style="left: 86.4px; top: 392.04812928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.782834249254823);">and side exits to verify the assumptions made in this recording: that</div><div data-canvas-width="45.190656000000004" style="left: 477.27216px; top: 393.00932736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">primes</div><div data-canvas-width="313.16407296000006" style="left: 526.0488px; top: 392.04812928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.753052483359242);">is an array and that the call to set its element succeeds.</div><div data-canvas-width="527.2243199999999" style="left: 86.3999999999999px; top: 434.85236736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045825785569);">mov edx, ebx(748)      // load primes from the trace activation record</div><div data-canvas-width="474.50188799999995" style="left: 86.3999999999999px; top: 450.79268736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.0504581301112);">mov edi(0), edx        // (*) store primes to interpreter stack</div><div data-canvas-width="489.56543999999997" style="left: 86.3999999999999px; top: 466.73284736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045816941719);">mov esi, ebx(764)      // load k from the trace activation record</div><div data-canvas-width="436.843008" style="left: 86.3999999999999px; top: 482.67316736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045801998666);">mov edi(8), esi        // (*) store k to interpreter stack</div><div data-canvas-width="466.9701119999999" style="left: 86.3999999999999px; top: 498.61332736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045810950725);">mov edi(16), 0         // (*) store false to interpreter stack</div><div data-canvas-width="474.50188799999995" style="left: 86.3999999999999px; top: 514.55348736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.0504581301112);">mov eax, edx(4)        // (*) load object class word for primes</div><div data-canvas-width="497.0972159999999" style="left: 86.3999999999999px; top: 530.49380736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045818817687);">and eax, -4            // (*) mask out object class tag for primes</div><div data-canvas-width="459.43833599999994" style="left: 86.3999999999999px; top: 546.43396736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045808822777);">cmp eax, Array         // (*) test whether primes is an array</div><div data-canvas-width="489.5654399999999" style="left: 86.3999999999999px; top: 562.37428736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045816941719);">jne side_exit_1        // (*) side exit if primes is not an array</div><div data-canvas-width="497.097216" style="left: 86.3999999999999px; top: 578.31444736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045818817687);">sub esp, 8             // bump stack for call alignment convention</div><div data-canvas-width="399.184128" style="left: 86.3999999999999px; top: 594.25460736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045788908395);">push false             // push last argument for call</div><div data-canvas-width="406.71590399999997" style="left: 86.3999999999999px; top: 610.19492736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045791720379);">push esi               // push first argument for call</div><div data-canvas-width="451.90655999999996" style="left: 86.3999999999999px; top: 626.13508736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045806623897);">call js_Array_set      // call function to set array element</div><div data-canvas-width="391.65235199999995" style="left: 86.3999999999999px; top: 642.07540736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045785988258);">add esp, 8             // clean up extra stack space</div><div data-canvas-width="444.374784" style="left: 86.3999999999999px; top: 658.01556736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045804350478);">mov ecx, ebx           // (*) created by register allocator</div><div data-canvas-width="474.50188799999995" style="left: 86.3999999999999px; top: 673.95572736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.0504581301112);">test eax, eax          // (*) test return value of js_Array_set</div><div data-canvas-width="406.7159039999999" style="left: 86.3999999999999px; top: 689.89604736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045791720379);">je side_exit_2         // (*) side exit if call failed</div><div data-canvas-width="22.595328" style="left: 86.3999999999999px; top: 705.83620736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">...</div><div data-canvas-width="90.38131200000001" style="left: 86.3999999999999px; top: 721.77652736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">side_exit_1:</div><div data-canvas-width="278.675712" style="left: 86.3999999999999px; top: 737.71668736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.0504572324481);">mov ecx, ebp(-4)       // restore ecx</div><div data-canvas-width="278.675712" style="left: 86.3999999999999px; top: 753.65684736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.0504572324481);">mov esp, ebp           // restore esp</div><div data-canvas-width="353.99347199999994" style="left: 86.3999999999999px; top: 769.59716736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045769523658);">jmp epilog             // jump to ret statement</div><div data-canvas-width="259.05005568" style="left: 86.4px; top: 805.9726144px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.881213011758803);">Figure 4. x86 snippet for sample program.</div><div data-canvas-width="541.12582656" style="left: 348.66192px; top: 806.14476928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.811515530012824);">This is the x86 code compiled from the LIR snippet in Figure 3. Most LIR instructions compile</div><div data-canvas-width="305.3023334399999" style="left: 86.4px; top: 822.08508928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.803406804585641);">to a single x86 instruction. Instructions marked with</div><div data-canvas-width="22.595328" style="left: 396.10784px; top: 823.04628736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">(*)</div><div data-canvas-width="466.6688409599999" style="left: 423.11504px; top: 822.08508928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.823878503445188);">would be omitted by an idealized compiler that knew that none of the side exits</div><div data-canvas-width="803.3894399999996" style="left: 86.4px; top: 838.02524928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.811948849758529);">would ever be taken. The 17 instructions generated by the compiler compare favorably with the 100+ instructions that the interpreter would</div><div data-canvas-width="355.38505728000007" style="left: 86.4px; top: 853.96556928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799445415935903);">execute for the same code snippet, including 4 indirect jumps.</div><div data-canvas-width="22.92529152" style="left: 105.52832px; top: 901.5318144px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799347886143611);">i=2.</div><div data-canvas-width="334.88428031999996" style="left: 134.0824px; top: 901.70396928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.805282153055787);">This is the first iteration of the outer loop. The loop on</div><div data-canvas-width="382.5711820799999" style="left: 86.4px; top: 917.64412928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">lines 4-5 becomes hot on its second iteration, so TraceMonkey en-</div><div data-canvas-width="382.57118207999997" style="left: 86.4px; top: 933.58444928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.874709315808582);">ters recording mode on line 4. In recording mode, TraceMonkey</div><div data-canvas-width="382.5711820799999" style="left: 86.4px; top: 949.52460928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">records the code along the trace in a low-level compiler intermedi-</div><div data-canvas-width="146.53249535999998" style="left: 86.4px; top: 965.46492928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.786034399640979);">ate representation we call</div><div data-canvas-width="21.51936" style="left: 236.62464px; top: 965.60839168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(1.00043540193193);">LIR</div><div data-canvas-width="210.81799679999992" style="left: 258.14384px; top: 965.46492928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.794670220377084);">. The LIR trace encodes all the oper-</div><div data-canvas-width="382.57118207999997" style="left: 86.4px; top: 981.40508928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">ations performed and the types of all operands. The LIR trace also</div><div data-canvas-width="46.20923903999999" style="left: 86.4px; top: 997.34524928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.920686408463641);">encodes</div><div data-canvas-width="39.32304384" style="left: 136.75168px; top: 997.48871168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.914064478898473);">guards</div><div data-canvas-width="292.89283584" style="left: 176.0744px; top: 997.34524928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.785573174628669);">, which are checks that verify that the control flow</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 1013.28556928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">and types are identical to those observed during trace recording.</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 1029.22572928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">Thus, on later executions, if and only if all guards are passed, the</div><div data-canvas-width="239.03705087999998" style="left: 86.3999999999999px; top: 1045.16604928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.81313458503213);">trace has the required program semantics.</div><div data-canvas-width="363.43329792000003" style="left: 105.52832px; top: 1061.10620928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.889264909060417);">TraceMonkey stops recording when execution returns to the</div><div data-canvas-width="382.57118208000014" style="left: 86.3999999999999px; top: 1077.04636928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.773293855566691);">loop header or exits the loop. In this case, execution returns to the</div><div data-canvas-width="124.71186431999999" style="left: 86.3999999999999px; top: 1092.98668928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.790616813544933);">loop header on line 4.</div><div data-canvas-width="363.43329792000003" style="left: 105.52832px; top: 1108.92684928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.817550085657364);">After recording is finished, TraceMonkey compiles the trace to</div><div data-canvas-width="382.57118208" style="left: 86.3999999999999px; top: 1124.86716928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">native code using the recorded type information for optimization.</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 1140.80732928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">The result is a native code fragment that can be entered if the</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 901.70396928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712817);">interpreter PC and the types of values match those observed when</div><div data-canvas-width="352.25757696" style="left: 507.22192px; top: 917.64412928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.818823725664494);">trace recording was started. The first trace in our example,</div><div style="left: 865.1128px; top: 917.41458944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 873.7144px; top: 922.32743296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">45</div><div style="left: 886.2008px; top: 917.64412928px; font-size: 14.34624px; font-family: sans-serif;">,</div><div data-canvas-width="382.5711820799998" style="left: 507.22192px; top: 933.58444928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.751510953562855);">covers lines 4 and 5. This trace can be entered if the PC is at line 4,</div><div style="left: 507.22192px; top: 950.48580736px; font-size: 14.34624px; font-family: monospace;">i</div><div data-canvas-width="20.71597056" style="left: 518.06032px; top: 949.52460928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.963085813593137);">and</div><div style="left: 542.08304px; top: 950.48580736px; font-size: 14.34624px; font-family: monospace;">k</div><div data-canvas-width="93.63790848000001" style="left: 552.92144px; top: 949.52460928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.768216690401142);">are integers, and</div><div data-canvas-width="45.190656000000004" style="left: 649.86496px; top: 950.48580736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">primes</div><div data-canvas-width="163.44671232" style="left: 698.36176px; top: 949.52460928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.786066243738653);">is an object. After compiling</div><div style="left: 865.1128px; top: 949.29506944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 873.7144px; top: 954.20791296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">45</div><div style="left: 886.2008px; top: 949.52460928px; font-size: 14.34624px; font-family: sans-serif;">,</div><div data-canvas-width="366.08735232000004" style="left: 507.22192px; top: 965.46492928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.797785448616629);">TraceMonkey returns to the interpreter and loops back to line 1.</div><div data-canvas-width="22.92529152" style="left: 526.35024px; top: 981.2329344px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799347886143611);">i=3.</div><div data-canvas-width="335.73070848" style="left: 554.052px; top: 981.40508928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.851352963204644);">Now the loop header at line 1 has become hot, so Trace-</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 997.34524928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.860601118470964);">Monkey starts recording. When recording reaches line 4, Trace-</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 1013.28556928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">Monkey observes that it has reached an inner loop header that al-</div><div data-canvas-width="382.5711820800001" style="left: 507.22192px; top: 1029.22572928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">ready has a compiled trace, so TraceMonkey attempts to nest the</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 1045.16604928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.741073312536463);">inner loop inside the current trace. The first step is to call the inner</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 1061.10620928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">trace as a subroutine. This executes the loop on line 4 to completion</div><div data-canvas-width="382.57118208" style="left: 507.22192px; top: 1077.04636928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">and then returns to the recorder. TraceMonkey verifies that the call</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 1092.98668928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.762246812577894);">was successful and then records the call to the inner trace as part of</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 1108.92684928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">the current trace. Recording continues until execution reaches line</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 1124.86716928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">1, and at which point TraceMonkey finishes and compiles a trace</div><div data-canvas-width="103.59419904" style="left: 507.22192px; top: 1140.80732928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.760436214457943);">for the outer loop,</div><div style="left: 614.4016px; top: 1140.57778944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 623.0032px; top: 1145.49047296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">16</div><div style="left: 635.489599999999px; top: 1140.80732928px; font-size: 14.34624px; font-family: sans-serif;">.</div><div class="endOfContent"></div></div></div><div id="pageContainer4" class="page" data-page-number="4" data-loaded="true" style="width: 979px; height: 1267px;"><div class="canvasWrapper" style="width: 979px; height: 1267px;"><canvas id="page4" width="980" height="1268" style="width: 980px; height: 1268px;"></canvas></div><div class="textLayer" style="width: 979px; height: 1267px;"><div data-canvas-width="22.92529152" style="left: 105.52832px; top: 118.0532544px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799347886143611);">i=4.</div><div data-canvas-width="208.35044351999997" style="left: 131.6488px; top: 118.22540928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.807184630125411);">On this iteration, TraceMonkey calls</div><div style="left: 343.1912px; top: 117.99586944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 351.7928px; top: 122.90871296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">16</div><div data-canvas-width="54.5874432" style="left: 364.2792px; top: 118.22540928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.845923712077998);">. Because</div><div data-canvas-width="22.595328" style="left: 422.0576px; top: 119.18660736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">i=4</div><div data-canvas-width="24.3168768" style="left: 444.65264px; top: 118.22540928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.678295202509848);">, the</div><div data-canvas-width="15.063552" style="left: 86.4px; top: 135.12692736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">if</div><div data-canvas-width="362.8307558400001" style="left: 106.13472px; top: 134.16572928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.816194655838646);">statement on line 2 is taken. This branch was not taken in the</div><div data-canvas-width="160.29053951999998" style="left: 86.4px; top: 150.10588928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.745190983052363);">original trace, so this causes</div><div style="left: 250.00304px; top: 149.87634944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 258.60464px; top: 154.78903296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">16</div><div data-canvas-width="194.56370687999996" style="left: 274.408px; top: 150.10588928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.733400308183329);">to fail a guard and take a side exit.</div><div data-canvas-width="382.57118208" style="left: 86.4px; top: 166.04604928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">The exit is not yet hot, so TraceMonkey returns to the interpreter,</div><div data-canvas-width="223.88742144" style="left: 86.4px; top: 181.98636928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.821726138489542);">which executes the continue statement.</div><div data-canvas-width="22.92529152" style="left: 105.52832px; top: 197.7543744px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799347886143611);">i=5.</div><div data-canvas-width="109.13184768" style="left: 131.67792px; top: 197.92652928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.895330835587787);">TraceMonkey calls</div><div style="left: 244.02944px; top: 197.69698944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 252.63104px; top: 202.60983296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">16</div><div data-canvas-width="203.84572416" style="left: 265.11744px; top: 197.92652928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.748167800961034);">, which in turn calls the nested trace</div><div style="left: 86.4px; top: 213.63730944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 95.0016px; top: 218.54999296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">45</div><div style="left: 107.488px; top: 213.86684928px; font-size: 14.34624px; font-family: sans-serif;">.</div><div style="left: 116.11536px; top: 213.63730944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 124.71696px; top: 218.54999296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">16</div><div data-canvas-width="326.72126976" style="left: 142.244px; top: 213.86684928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799436270435477);">loops back to its own header, starting the next iteration</div><div data-canvas-width="215.40879360000002" style="left: 86.4px; top: 229.80700928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.790607328554432);">without ever returning to the monitor.</div><div data-canvas-width="22.92529152" style="left: 105.52832px; top: 245.5750144px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.799347886143611);">i=6.</div><div data-canvas-width="337.03621632" style="left: 131.93568px; top: 245.74716928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.746134931238168);">On this iteration, the side exit on line 2 is taken again. This</div><div data-canvas-width="250.54273536000002" style="left: 86.4px; top: 261.68748928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.812633019173939);">time, the side exit becomes hot, so a trace</div><div style="left: 341.98752px; top: 261.45794944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 350.58912px; top: 266.37063296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">23</div><div style="left: 362.2784px; top: 266.37063296px; font-size: 9.56416px; font-family: sans-serif;">,</div><div style="left: 365.90928px; top: 266.37063296px; font-size: 9.56416px; font-family: sans-serif;">1</div><div data-canvas-width="91.37120256" style="left: 377.59904px; top: 261.68748928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796471634363057);">is recorded that</div><div data-canvas-width="348.3123609599999" style="left: 86.3999999999999px; top: 277.62764928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.783535251635225);">covers line 3 and returns to the loop header. Thus, the end of</div><div style="left: 438.40208px; top: 277.39810944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 447.00368px; top: 282.31095296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">23</div><div style="left: 458.69296px; top: 282.31095296px; font-size: 9.56416px; font-family: sans-serif;">,</div><div style="left: 462.32368px; top: 282.31095296px; font-size: 9.56416px; font-family: sans-serif;">1</div><div data-canvas-width="166.73200128" style="left: 86.3999999999998px; top: 293.56796928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.775137349416859);">jumps directly to the start of</div><div style="left: 257.63104px; top: 293.33842944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 266.23264px; top: 298.25111296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">16</div><div data-canvas-width="190.24548864" style="left: 278.71888px; top: 293.56796928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.780398462648195);">. The side exit is patched so that</div><div data-canvas-width="225.14989056000002" style="left: 86.3999999999998px; top: 309.50812928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.747658951014171);">on future iterations, it jumps directly to</div><div style="left: 315.13296px; top: 309.27858944px; font-size: 14.34624px; font-family: sans-serif;">T</div><div data-canvas-width="11.687403519999998" style="left: 323.73456px; top: 314.19127296px; font-size: 9.56416px; font-family: sans-serif; transform: scaleX(0.973950293333333);">23</div><div style="left: 335.42384px; top: 314.19127296px; font-size: 9.56416px; font-family: sans-serif;">,</div><div style="left: 339.05456px; top: 314.19127296px; font-size: 9.56416px; font-family: sans-serif;">1</div><div style="left: 345.69632px; top: 309.50812928px; font-size: 14.34624px; font-family: sans-serif;">.</div><div data-canvas-width="363.43329792" style="left: 105.52832px; top: 325.44828928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.817550085657364);">At this point, TraceMonkey has compiled enough traces to cover</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 341.38860928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">the entire nested loop structure, so the rest of the program runs</div><div data-canvas-width="131.6984832" style="left: 86.3999999999999px; top: 357.32876928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.765333082477926);">entirely as native code.</div><div data-canvas-width="117.84762703999999" style="left: 86.3999999999999px; top: 398.3143344px; font-size: 17.53424px; font-family: sans-serif; transform: scaleX(0.896350144486257);">3.  Trace Trees</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 423.00252928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">In this section, we describe traces, trace trees, and how they are</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 438.94268928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712817);">formed at run time. Although our techniques apply to any dynamic</div><div data-canvas-width="382.57118208" style="left: 86.3999999999999px; top: 454.88300928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">language interpreter, we will describe them assuming a bytecode</div><div data-canvas-width="234.73317888000005" style="left: 86.3999999999999px; top: 470.82316928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.779482334426778);">interpreter to keep the exposition simple.</div><div data-canvas-width="72.64935935999999" style="left: 86.3999999999999px; top: 503.8066944px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.921128159160598);">3.1  Traces</div><div style="left: 86.3999999999999px; top: 526.29516928px; font-size: 14.34624px; font-family: sans-serif;">A</div><div data-canvas-width="29.2663296" style="left: 101.5992px; top: 526.43863168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.816355287976454);">trace</div><div data-canvas-width="333.26315519999997" style="left: 135.70768px; top: 526.29516928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.84509568990872);">is simply a program path, which may cross function call</div><div data-canvas-width="215.59529471999997" style="left: 86.3999999999998px; top: 542.23532928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.884384895307825);">boundaries. TraceMonkey focuses on</div><div data-canvas-width="64.38592512" style="left: 306.03104px; top: 542.37879168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.816355287976454);">loop traces</div><div data-canvas-width="98.5586688" style="left: 370.41424px; top: 542.23532928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7234727590813);">, that originate at</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999998px; top: 558.17564928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">a loop edge and represent a single iteration through the associated</div><div data-canvas-width="29.094174719999998" style="left: 86.3999999999998px; top: 574.11580928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.811553198047181);">loop.</div><div data-canvas-width="363.43329792000003" style="left: 105.52832px; top: 590.05612928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.817550085657364);">Similar to an extended basic block, a trace is only entered at</div><div data-canvas-width="382.57118208" style="left: 86.3999999999998px; top: 605.99628928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">the top, but may have many exits. In contrast to an extended basic</div><div data-canvas-width="382.5711820800001" style="left: 86.3999999999998px; top: 621.93644928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712817);">block, a trace can contain join nodes. Since a trace always only</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999998px; top: 637.87676928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">follows one single path through the original program, however, join</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999998px; top: 653.81692928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">nodes are not recognizable as such in a trace and have a single</div><div data-canvas-width="208.79517696000002" style="left: 86.3999999999998px; top: 669.75724928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808907602206517);">predecessor node like regular nodes.</div><div style="left: 105.52832px; top: 685.69740928px; font-size: 14.34624px; font-family: sans-serif;">A</div><div data-canvas-width="63.89815295999999" style="left: 119.4448px; top: 685.84087168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.810170778219057);">typed trace</div><div data-canvas-width="282.06142463999987" style="left: 186.90128px; top: 685.69740928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.771355794080611);">is a trace annotated with a type for every variable</div><div data-canvas-width="382.57118207999986" style="left: 86.3999999999998px; top: 701.63756928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">(including temporaries) on the trace. A typed trace also has an entry</div><div data-canvas-width="52.95197183999999" style="left: 86.3999999999998px; top: 717.72135168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.923151767132688);">type map</div><div data-canvas-width="325.27229952" style="left: 143.7008px; top: 717.57788928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.79589086500323);">giving the required types for variables used on the trace</div><div data-canvas-width="382.57118208" style="left: 86.3999999999998px; top: 733.51804928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">before they are defined. For example, a trace could have a type map</div><div data-canvas-width="150.63551999999999" style="left: 86.3999999999998px; top: 750.41956736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">(x: int, b: boolean)</div><div data-canvas-width="231.93566207999996" style="left: 237.03344px; top: 749.45836928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.829438040552767);">, meaning that the trace may be entered</div><div data-canvas-width="180.31789056" style="left: 86.3999999999998px; top: 765.39852928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.762089246477722);">only if the value of the variable</div><div style="left: 270.46576px; top: 766.35972736px; font-size: 14.34624px; font-family: monospace;">x</div><div data-canvas-width="53.712322560000004" style="left: 281.74256px; top: 765.39852928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.749126028966629);">is of type</div><div data-canvas-width="22.595328" style="left: 339.20096px; top: 766.35972736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">int</div><div data-canvas-width="92.14589952" style="left: 365.54112px; top: 765.39852928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.803224573326098);">and the value of</div><div style="left: 461.43376px; top: 766.35972736px; font-size: 14.34624px; font-family: monospace;">b</div><div data-canvas-width="53.870131199999996" style="left: 86.3999999999998px; top: 781.33868928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.751326986850879);">is of type</div><div data-canvas-width="52.722432" style="left: 144.096px; top: 782.29988736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">boolean</div><div data-canvas-width="272.1481728" style="left: 196.81776px; top: 781.33868928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.80758591605422);">. The entry type map is much like the signature</div><div data-canvas-width="76.8958464" style="left: 86.3999999999998px; top: 797.27900928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.766047679193591);">of a function.</div><div data-canvas-width="363.43329792000003" style="left: 105.52832px; top: 813.21916928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.83095252924509);">In this paper, we only discuss typed loop traces, and we will</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999998px; top: 829.15948928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">refer to them simply as “traces”. The key property of typed loop</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999998px; top: 845.09964928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">traces is that they can be compiled to efficient machine code using</div><div data-canvas-width="265.74974976" style="left: 86.3999999999998px; top: 861.03980928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.823647701029841);">the same techniques used for typed languages.</div><div data-canvas-width="338.16956927999996" style="left: 105.52832px; top: 876.98012928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.827448483652633);">In TraceMonkey, traces are recorded in trace-flavored SSA</div><div data-canvas-width="21.51936" style="left: 447.44624px; top: 877.12359168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(1.00043540193193);">LIR</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 892.92028928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">(low-level intermediate representation). In trace-flavored SSA (or</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 908.86060928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">TSSA), phi nodes appear only at the entry point, which is reached</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 924.80076928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.860601118470964);">both on entry and via loop edges. The important LIR primitives</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 940.74092928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.889287785790302);">are constant values, memory loads and stores (by address and</div><div data-canvas-width="382.57118208" style="left: 86.3999999999999px; top: 956.68124928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">offset), integer operators, floating-point operators, function calls,</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 972.62140928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">and conditional exits. Type conversions, such as integer to double,</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 988.56172928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.874709315808582);">are represented by function calls. This makes the LIR used by</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 1004.50188928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.889287785790302);">TraceMonkey independent of the concrete type system and type</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 1020.44204928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">conversion rules of the source language. The LIR operations are</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 1036.38236928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">generic enough that the backend compiler is language independent.</div><div data-canvas-width="218.16327168" style="left: 86.3999999999999px; top: 1052.32252928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.845201175398825);">Figure 3 shows an example LIR trace.</div><div data-canvas-width="363.43329792" style="left: 105.52832px; top: 1068.26284928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.83095252924509);">Bytecode interpreters typically represent values in a various</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 1084.20300928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">complex data structures (e.g., hash tables) in a boxed format (i.e.,</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 1100.14316928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">with attached type tag bits). Since a trace is intended to represent</div><div data-canvas-width="382.5711820799999" style="left: 86.3999999999999px; top: 1116.08348928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">efficient code that eliminates all that complexity, our traces oper-</div><div data-canvas-width="382.57118207999997" style="left: 86.3999999999999px; top: 1132.02364928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">ate on unboxed values in simple variables and arrays as much as</div><div data-canvas-width="50.613534720000004" style="left: 86.3999999999999px; top: 1147.96396928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.784341355114633);">possible.</div><div data-canvas-width="363.43329792000003" style="left: 526.35024px; top: 118.22540928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.779817049255552);">A trace records all its intermediate values in a small activation</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 134.16572928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">record area. To make variable accesses fast on trace, the trace also</div><div data-canvas-width="382.57118208" style="left: 507.22192px; top: 150.10588928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">imports local and global variables by unboxing them and copying</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 166.04604928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">them to its activation record. Thus, the trace can read and write</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 181.98636928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">these variables with simple loads and stores from a native activation</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 197.92652928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.889287785790302);">recording, independently of the boxing mechanism used by the</div><div data-canvas-width="382.5711820800001" style="left: 507.22192px; top: 213.86684928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">interpreter. When the trace exits, the VM boxes the values from</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 229.80700928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">this native storage location and copies them back to the interpreter</div><div data-canvas-width="59.36474111999999" style="left: 507.22192px; top: 245.74716928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.752691216944422);">structures.</div><div data-canvas-width="363.43329792" style="left: 526.35024px; top: 261.68748928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.905144617854394);">For every control-flow branch in the source program, the</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 277.62764928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">recorder generates conditional exit LIR instructions. These instruc-</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 293.56796928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">tions exit from the trace if required control flow is different from</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 309.50812928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">what it was at trace recording, ensuring that the trace instructions</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 325.44828928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712817);">are run only if they are supposed to. We call these instructions</div><div data-canvas-width="33.74235648" style="left: 507.22192px; top: 341.53207168px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.941209626137559);">guard</div><div data-canvas-width="70.54046207999998" style="left: 544.93776px; top: 341.38860928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.756790903276815);">instructions.</div><div data-canvas-width="330.4656384" style="left: 526.35024px; top: 357.32876928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.781188088204445);">Most of our traces represent loops and end with the special</div><div data-canvas-width="30.127104" style="left: 859.66064px; top: 358.28996736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">loop</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 373.26908928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">LIR instruction. This is just an unconditional branch to the top of</div><div data-canvas-width="255.37741824000003" style="left: 507.22192px; top: 389.20924928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.774293862123249);">the trace. Such traces return only via guards.</div><div data-canvas-width="363.43329792000003" style="left: 526.35024px; top: 405.14940928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.84480172038196);">Now, we describe the key optimizations that are performed as</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 421.08972928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712816);">part of recording LIR. All of these optimizations reduce complex</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 437.02988928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.860601118470964);">dynamic language constructs to simple typed constructs by spe-</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 452.970209279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">cializing for the current trace. Each optimization requires guard in-</div><div data-canvas-width="382.5711820800001" style="left: 507.22192px; top: 468.91036928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">structions to verify their assumptions about the state and exit the</div><div data-canvas-width="102.23130623999998" style="left: 507.22192px; top: 484.85052928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.750431860438624);">trace if necessary.</div><div data-canvas-width="120.09237504000001" style="left: 526.35024px; top: 500.618694399999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.837464474957218);">Type specialization.</div><div data-canvas-width="363.43329792000003" style="left: 526.35024px; top: 516.731009279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.83095252924509);">All LIR primitives apply to operands of specific types. Thus,</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 532.671329279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">LIR traces are necessarily type-specialized, and a compiler can</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 548.611489279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712816);">easily produce a translation that requires no type dispatches. A</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 564.551649279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">typical bytecode interpreter carries tag bits along with each value,</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 580.491969279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">and to perform any operation, must check the tag bits, dynamically</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 596.43212928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.860601118470964);">dispatch, mask out the tag bits to recover the untagged value,</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 612.372449279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">perform the operation, and then reapply tags. LIR omits everything</div><div data-canvas-width="151.98406655999997" style="left: 507.22192px; top: 628.312609279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.757043760576204);">except the operation itself.</div><div data-canvas-width="363.43329792000003" style="left: 526.35024px; top: 644.252769279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.817550085657364);">A potential problem is that some operations can produce values</div><div data-canvas-width="382.57118208" style="left: 507.22192px; top: 660.193089279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">of unpredictable types. For example, reading a property from an</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 676.133249279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712817);">object could yield a value of any type, not necessarily the type</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 692.073569279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712816);">observed during recording. The recorder emits guard instructions</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 708.013729279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.762246812577894);">that conditionally exit if the operation yields a value of a different</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 723.953889279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.860601118470964);">type from that seen during recording. These guard instructions</div><div data-canvas-width="382.57118207999986" style="left: 507.22192px; top: 739.894209279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">guarantee that as long as execution is on trace, the types of values</div><div data-canvas-width="382.5711820800001" style="left: 507.22192px; top: 755.834369279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.833707365712817);">match those of the typed trace. When the VM observes a side exit</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 771.774689279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">along such a type guard, a new typed trace is recorded originating</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 787.714849279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">at the side exit location, capturing the new type of the operation in</div><div data-canvas-width="52.205967359999995" style="left: 507.22192px; top: 803.655009279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.80901876169562);">question.</div><div data-canvas-width="239.4387456" style="left: 526.35024px; top: 819.423174399999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.856270235468899);">Representation specialization: objects.</div><div data-canvas-width="117.91174656" style="left: 771.87632px; top: 819.595329279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.865534586155634);">In JavaScript, name</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 835.535489279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.860601118470964);">lookup semantics are complex and potentially expensive because</div><div data-canvas-width="275.6630015999999" style="left: 507.22192px; top: 851.47580928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.784627636809234);">they include features like object inheritance and</div><div data-canvas-width="30.127104" style="left: 786.6536px; top: 852.43700736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">eval</div><div data-canvas-width="73.00801535999999" style="left: 816.78032px; top: 851.47580928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.783263963143321);">. To evaluate</div><div data-canvas-width="230.40061440000008" style="left: 507.22192px; top: 867.415969279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.823948471038378);">an object property read expression like</div><div data-canvas-width="22.595328" style="left: 742.82688px; top: 868.377167359999px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">o.x</div><div data-canvas-width="124.36755456" style="left: 765.42192px; top: 867.415969279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.788434045395263);">, the interpreter must</div><div data-canvas-width="155.67105024" style="left: 507.22192px; top: 883.356129279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.835055734335643);">search the property map of</div><div style="left: 666.95664px; top: 884.31732736px; font-size: 14.34624px; font-family: monospace;">o</div><div data-canvas-width="211.23403776000004" style="left: 678.54944px; top: 883.356129279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.775284868840191);">and all of its prototypes and parents.</div><div data-canvas-width="382.57118207999986" style="left: 507.22192px; top: 899.296449279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869246);">Property maps can be implemented with different data structures</div><div data-canvas-width="382.5711820800001" style="left: 507.22192px; top: 915.23660928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796377227844883);">(e.g., per-object hash tables or shared hash tables), so the search</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 931.176929279999px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.846940799869247);">process also must dispatch on the representation of each object</div><div data-canvas-width="382.5711820800001" style="left: 507.22192px; top: 947.11708928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">found during search. TraceMonkey can simply observe the result of</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 963.05724928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">the search process and record the simplest possible LIR to access</div><div data-canvas-width="382.57118208" style="left: 507.22192px; top: 978.99756928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">the property value. For example, the search might finds the value of</div><div data-canvas-width="22.595328" style="left: 507.22192px; top: 995.89892736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">o.x</div><div data-canvas-width="105.80351999999999" style="left: 533.20912px; top: 994.93772928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.776653798868208);">in the prototype of</div><div style="left: 642.40848px; top: 995.89892736px; font-size: 14.34624px; font-family: monospace;">o</div><div data-canvas-width="239.85478655999998" style="left: 649.94016px; top: 994.93772928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.796489741430223);">, which uses a shared hash-table represen-</div><div data-canvas-width="96.72235008" style="left: 507.22192px; top: 1010.87804928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.749437275536119);">tation that places</div><div style="left: 607.27936px; top: 1011.83924736px; font-size: 14.34624px; font-family: monospace;">x</div><div data-canvas-width="271.6460544" style="left: 618.14704px; top: 1010.87804928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.773194082903089);">in slot 2 of a property vector. Then the recorded</div><div data-canvas-width="156.37401599999998" style="left: 507.22192px; top: 1026.81820928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.807758954152447);">can generate LIR that reads</div><div data-canvas-width="22.595328" style="left: 666.84656px; top: 1027.77940736px; font-size: 14.34624px; font-family: monospace; transform: scaleX(1.05045717202853);">o.x</div><div data-canvas-width="197.10299136" style="left: 692.68608px; top: 1026.81820928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.763610110396821);">with just two or three loads: one to</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 1042.75836928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">get the prototype, possibly one to get the property value vector, and</div><div data-canvas-width="382.57118207999986" style="left: 507.22192px; top: 1058.69868928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.77329385556669);">one more to get slot 2 from the vector. This is a vast simplification</div><div data-canvas-width="382.5711820799999" style="left: 507.22192px; top: 1074.63884928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.808443535472226);">and speedup compared to the original interpreter code. Inheritance</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 1090.57916928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.820881113665883);">relationships and object representations can change during execu-</div><div data-canvas-width="382.57118207999997" style="left: 507.22192px; top: 1106.51932928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.7846658112185);">tion, so the simplified code requires guard instructions that ensure</div><div data-canvas-width="382.57118208" style="left: 507.22192px; top: 1122.45948928px; font-size: 14.34624px; font-family: sans-serif; transform: scaleX(0.773293760164823);">the object representation is the same. In TraceMonkey, objects’ rep-</div><div class="endOfContent"></div></div></div><div id="pageContainer5" class="page" data-page-number="5" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer6" class="page" data-page-number="6" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer7" class="page" data-page-number="7" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer8" class="page" data-page-number="8" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer9" class="page" data-page-number="9" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer10" class="page" data-page-number="10" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer11" class="page" data-page-number="11" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer12" class="page" data-page-number="12" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer13" class="page" data-page-number="13" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div><div id="pageContainer14" class="page" data-page-number="14" style="width: 979px; height: 1267px;"><div class="loadingIcon"></div></div></div>
        </div>

        <div id="errorWrapper" hidden="true">
          <div id="errorMessageLeft">
            <span id="errorMessage"></span>
            <button id="errorShowMore" data-l10n-id="error_more_info">更多信息</button>
            <button id="errorShowLess" data-l10n-id="error_less_info" hidden="true">更少信息</button>
          </div>
          <div id="errorMessageRight">
            <button id="errorClose" data-l10n-id="error_close">关闭</button>
          </div>
          <div class="clearBoth"></div>
          <textarea id="errorMoreInfo" hidden="true" readonly="readonly"></textarea>
        </div>
      </div> <!-- mainContainer -->

      <div id="overlayContainer" class="hidden">
        <div id="passwordOverlay" class="container hidden">
          <div class="dialog">
            <div class="row">
              <p id="passwordText" data-l10n-id="password_label">输入密码以打开此 PDF 文件。</p>
            </div>
            <div class="row">
              <input type="password" id="password" class="toolbarField">
            </div>
            <div class="buttonRow">
              <button id="passwordCancel" class="overlayButton"><span data-l10n-id="password_cancel">取消</span></button>
              <button id="passwordSubmit" class="overlayButton"><span data-l10n-id="password_ok">确定</span></button>
            </div>
          </div>
        </div>
        <div id="documentPropertiesOverlay" class="container hidden">
          <div class="dialog">
            <div class="row">
              <span data-l10n-id="document_properties_file_name">文件名:</span> <p id="fileNameField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_file_size">文件大小:</span> <p id="fileSizeField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span data-l10n-id="document_properties_title">标题:</span> <p id="titleField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_author">作者:</span> <p id="authorField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_subject">主题:</span> <p id="subjectField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_keywords">关键词:</span> <p id="keywordsField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_creation_date">创建日期:</span> <p id="creationDateField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_modification_date">修改日期:</span> <p id="modificationDateField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_creator">创建者:</span> <p id="creatorField">-</p>
            </div>
            <div class="separator"></div>
            <div class="row">
              <span data-l10n-id="document_properties_producer">PDF 制作者:</span> <p id="producerField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_version">PDF 版本:</span> <p id="versionField">-</p>
            </div>
            <div class="row">
              <span data-l10n-id="document_properties_page_count">页数:</span> <p id="pageCountField">-</p>
            </div>
            <div class="buttonRow">
              <button id="documentPropertiesClose" class="overlayButton"><span data-l10n-id="document_properties_close">关闭</span></button>
            </div>
          </div>
        </div>
      </div>  <!-- overlayContainer -->

    </div> <!-- outerContainer -->
    <div id="printContainer"></div>
<div id="mozPrintCallback-shim" hidden="">
  <style>
@media print {
  #printContainer div {
    page-break-after: always;
    page-break-inside: avoid;
  }
}
  </style>
  <style scoped="">
#mozPrintCallback-shim {
  position: fixed;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  z-index: 9999999;

  display: block;
  text-align: center;
  background-color: rgba(0, 0, 0, 0.5);
}
#mozPrintCallback-shim[hidden] {
  display: none;
}
@media print {
  #mozPrintCallback-shim {
    display: none;
  }
}

#mozPrintCallback-shim .mozPrintCallback-dialog-box {
  display: inline-block;
  margin: -50px auto 0;
  position: relative;
  top: 45%;
  left: 0;
  min-width: 220px;
  max-width: 400px;

  padding: 9px;

  border: 1px solid hsla(0, 0%, 0%, .5);
  border-radius: 2px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);

  background-color: #474747;

  color: hsl(0, 0%, 85%);
  font-size: 16px;
  line-height: 20px;
}
#mozPrintCallback-shim .progress-row {
  clear: both;
  padding: 1em 0;
}
#mozPrintCallback-shim progress {
  width: 100%;
}
#mozPrintCallback-shim .relative-progress {
  clear: both;
  float: right;
}
#mozPrintCallback-shim .progress-actions {
  clear: both;
}
  </style>
  <div class="mozPrintCallback-dialog-box">
    <!-- TODO: Localise the following strings -->
    Preparing document for printing...
    <div class="progress-row">
      <progress value="0" max="100"></progress>
      <span class="relative-progress">0%</span>
    </div>
    <div class="progress-actions">
      <input type="button" value="Cancel" class="mozPrintCallback-cancel">
    </div>
  </div>
</div>

  


<input id="fileInput" class="fileInput" type="file"></body></html>